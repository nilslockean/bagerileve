---
import type { HTMLAttributes } from "astro/types";
import type { Product } from "@lib/schemas/Product";
import { capitalize } from "@lib/stringUtils";
import { PICKUP_DATE_MIN_OFFSET } from "astro:env/server";
import { PICKUP_DATE_MAX_OFFSET } from "astro:env/server";

interface Props extends HTMLAttributes<"fieldset"> {
  product: Product;
  defaultPickupDates: string[];
}

const { product, defaultPickupDates, class: className, ...rest } = Astro.props;
const pickupDates = product.pickupDates || defaultPickupDates;
const dateFormatter = new Intl.DateTimeFormat("sv-SE", {
  dateStyle: "full",
});
function formatDate(dateStr: string) {
  const formattedDate = dateFormatter.format(new Date(dateStr));
  return capitalize(formattedDate);
}
---

<fieldset {...rest}>
  <legend>Tillgänglighet</legend>
  {
    product.pickupDates && product.pickupDates.length > 0 ? (
      <p>{product.title} endast att hämta under specifika datum.</p>
    ) : (
      <>
        <p>
          {product.title} går att hämta under våra öppettider med minst{" "}
          {PICKUP_DATE_MIN_OFFSET}
          dagars framförhållning, och max {PICKUP_DATE_MAX_OFFSET} dagar in i
          framtiden.
        </p>
      </>
    )
  }

  <select>
    <option value="" selected={pickupDates.length !== 1}>
      {
        pickupDates.length === 0
          ? "Inga datum tillgängliga"
          : "Välj datum för upphämtning"
      }
    </option>
    {
      pickupDates.map((dateStr, i) => (
        <option value={dateStr} selected={pickupDates.length === 1 && i === 0}>
          {formatDate(dateStr)}
        </option>
      ))
    }
  </select>
</fieldset>
