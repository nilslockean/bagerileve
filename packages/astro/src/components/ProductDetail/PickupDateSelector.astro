---
import type { HTMLAttributes } from "astro/types";
import type { Product } from "@lib/schemas/Product";
import { capitalize } from "@lib/stringUtils";
import { PICKUP_DATE_MIN_OFFSET } from "astro:env/server";
import { PICKUP_DATE_MAX_OFFSET } from "astro:env/server";

interface Props extends HTMLAttributes<"fieldset"> {
  product: Product;
  availablePickupDates: string[];
}

const {
  product,
  availablePickupDates,
  class: className,
  ...rest
} = Astro.props;
const dateFormatter = new Intl.DateTimeFormat("sv-SE", {
  dateStyle: "full",
});
function formatDate(dateStr: string) {
  const formattedDate = dateFormatter.format(new Date(dateStr));
  return capitalize(formattedDate);
}
---

<fieldset {...rest}>
  <legend>Tillgänglighet</legend>
  {
    product.pickupDates && product.pickupDates.length > 0 ? (
      <p>{product.title} går endast att hämta under specifika datum.</p>
    ) : (
      <>
        <p>
          {product.title} går att hämta under våra öppettider med minst{" "}
          {PICKUP_DATE_MIN_OFFSET}
          dagars framförhållning, och max {PICKUP_DATE_MAX_OFFSET} dagar in i
          framtiden.
        </p>
      </>
    )
  }

  <select>
    <option value="" selected={availablePickupDates.length !== 1}>
      {
        availablePickupDates.length === 0
          ? "Inga datum tillgängliga"
          : "Välj datum för upphämtning"
      }
    </option>
    {
      availablePickupDates.map((dateStr, i) => (
        <option
          value={dateStr}
          selected={availablePickupDates.length === 1 && i === 0}
        >
          {formatDate(dateStr)}
        </option>
      ))
    }
  </select>
</fieldset>
