---
import ButtonLink from "@components/ButtonLink.astro";
import Section from "@components/Section.astro";
import OpeningHours from "@components/OpeningHours.astro";
import Layout from "../layouts/Layout.astro";
import { Image } from "astro:assets";
import { fetchOpeningHours } from "@lib/sanity";
import InstagramFeed from "@components/InstagramFeed.astro";
import { sanityAsset as sa } from "@lib/sanityAsset";
import breadImage from "@lib/assets/brod.jpg";
import cinnamonBunImage from "@lib/assets/170711_0258_leve_bageri.jpg";
import IntroText from "@components/IntroText.astro";
import MediaBlock from "@components/MediaBlock.astro";
import {
  BEHOLD_FEED_ID,
  SANITY_PROJECT_ID,
  SANITY_DATASET,
} from "astro:env/server";

const openingHours = await fetchOpeningHours();
const instagramFeedId = BEHOLD_FEED_ID;

const sanityAsset = (filename: string) =>
  sa(filename, SANITY_PROJECT_ID, SANITY_DATASET);

const headingText = "Ett hantverksbageri i hjärtat av Malmö";
const introText =
  "Surdegsbröd ur ugnen på eftermiddagen och allt vi bakar är växtbaserat.";
---

<Layout
  title="Bageri Leve"
  description="Bageriet som vänder på bröddygnet"
  metaDescription="Bageri Leve på Östra Rönneholmsvägen 6 i Malmö. Vi vill revolutionera bageribranschen och satsa på nybakat bröd till kvällen istället för på morgonen. Med bästa ekologiska ingredienserna som finns gör vi bröd på traditionellt sätt, utan att tillsätta modern bagerijäst."
  htmx
  fullwidth
>
  <Section fullwidth class="relative aspect-video flex items-center">
    <video
      id="hero-video"
      muted
      playsinline
      controls={true}
      loop={false}
      autoplay={false}
      class="w-full absolute z-10"
    >
      <source
        src={sanityAsset("9c057df538547c79bedfa2b06e6f276323deecee.mp4")}
        type="video/mp4"
      />
    </video>

    <!-- Color overlay -->
    <div
      id="hero-video-overlay"
      class="absolute hidden lg:block inset-0 bg-blue-950 opacity-50 z-20 aspect-video w-full"
    >
    </div>

    <div
      class="z-30 hidden lg:flex flex-col items-start p-6 w-full max-w-screen-2xl mx-auto text-orange-50"
    >
      <h1>{headingText}</h1>
      <IntroText>
        {introText}
      </IntroText>
      <div>
        <ButtonLink href="/bestall" variant="primary"
          >Beställ fredagsmunk</ButtonLink
        >
        <ButtonLink href="#oppettider" variant="outline-light"
          >Kolla öppettider</ButtonLink
        >
      </div>
    </div>
  </Section>

  <Section class="lg:hidden">
    <h1>{headingText}</h1>
    <IntroText>
      {introText}
    </IntroText>
    <ButtonLink href="/bestall" variant="primary"
      >Beställ fredagsmunk</ButtonLink
    >
  </Section>

  <Section id="oppettider" class="lg:mt-8 grid lg:grid-cols-2 gap-8">
    <div>
      <h2>Öppettider</h2>
      <OpeningHours data={openingHours} class="max-w-xl" />
      <ButtonLink href="/kontakt">Hitta hit</ButtonLink>
    </div>
    <div
      hx-get="/partials/events?scope=upcoming"
      hx-trigger="load"
      class="empty:hidden"
    >
      Hämtar kommande kurser...
    </div>
  </Section>

  <Section>
    <h2>Välkommen till Bageri Leve</h2>
    <p class="text-lg max-w-prose">
      Ett nytänkande bageri mitt i Malmö. Vi har valt att baka på dagen istället
      för på natten, att endast baka växtbaserade bakverk istället för att låsa
      fast oss helt i traditionella smörbaserade recept och att baka surdegsbröd
      som man gjorde förr, innan jästen ens var uppfunnen.
    </p>
  </Section>

  <Section>
    <MediaBlock image={{ src: breadImage, alt: "En hög bröd på ett bord" }}>
      <h3 class="mb-4">Har du smakat riktigt bröd?</h3>
      <p class="text-lg mb-4 max-w-prose">
        Alla våra bröd är bakade i stenugn och med surdegskultur. När vi letar
        efter råvaror kollar vi i vår närhet efter de bästa, mest smakrika
        grejerna vi kan hitta.
      </p>

      <ButtonLink href="/kontakt">Kom hit</ButtonLink>
    </MediaBlock>
  </Section>

  <Section class="my-8">
    <IntroText>
      Vi vill att vår verksamhet ska ha en låg miljöpåverkan, och därför arbetar
      vi aktivt för att minimera svinn och använda de råvaror som finns lokalt
      och är i säsong. Vi är också stora på växtbaserade sötsaker där smör och
      ägg helt byts ut mot andra, vegetibilska alternativ. Utöver detta använder
      vi second hand-möbler och kläder samt 100 % grön el.
    </IntroText>
  </Section>

  {
    typeof instagramFeedId === "string" && (
      <Section>
        <InstagramFeed feedId={instagramFeedId} />
        <ButtonLink
          href="https://www.instagram.com/bagerileve"
          target="_blank"
          rel="noreferrer"
        >
          Följ @bagerileve
        </ButtonLink>
      </Section>
    )
  }

  <Section fullwidth>
    <Image
      class="w-full"
      src={cinnamonBunImage}
      alt="Butikspersonal lägger kanelbullar i en papperspåse"
    />
  </Section>
</Layout>

<script>
  // Make sure the video only autoplays when it is rendered as a background video
  const heroVideo = document.querySelector<HTMLVideoElement>("#hero-video");
  const heroVideoOverlay = document.querySelector<HTMLDivElement>(
    "#hero-video-overlay"
  );
  const isOverlayVisible =
    heroVideoOverlay && getComputedStyle(heroVideoOverlay).display !== "none";

  if (heroVideo && isOverlayVisible) {
    heroVideo.autoplay = true;
    heroVideo.controls = false;
    heroVideo.loop = true;
  }
</script>
